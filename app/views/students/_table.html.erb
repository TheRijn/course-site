<table id="grade-table" class="table table-sm table-striped table-responsive">

	<tr>
		<th>Name</th>
		<th><span class="fa fa-sticky-note" aria-hidden="true"></span></th>
		<th><span class="fa fa-exclamation-triangle" aria-hidden="true"></span></th>
		<th>Attend</th>
		<th class="rotate">Spoken</th>
		<% if params[:status] == 'registered' %>
		<th class="rotate">Start date</th>
		<% end %>
		<th>Latest</th>
		<th>Submitted</th>
		<th>Grade</th>
	</tr>

	<% users.each do |group, user_list|%>
	<tr><td colspan="20"><%= group ? "#{group.name} (#{user_list.size})" : "Groupless" %></td></tr>

	<% user_list.each do |user| %>
	<tr <%= 'class=table-warning' if user.stagnated? %>>
		<td>
			<!-- <%= link_to user.name, user_path(user) %> -->
			<a href="#" class="" data-toggle="modal" data-target="#user-modal" data-user="<%= user.id %>"><%= user.name %></a>
			<span class="fa fa-location-arrow" aria-hidden="true" data-toggle="tooltip" title="<%= user.last_known_location %>"></span>
		</td>
		
		<td>N</td>
		
		<td>
			<% if user.alarm %>
			<span class="fa fa-exclamation-triangle" aria-hidden="true"></span>
			<% end %>
		</td>
		
		<td class="bar"><%= user.attendance %></td>
		
		<td><%= user.attendance %><%= user.questions_count_cache %></td>
		
		<% if params[:status] == 'registered' %>
		<td><%= user.started_at.strftime("%e %b") if user.started_at %></td>
		<% end %>
		
		<td><%= user.submits.last.pset.name if user.submits.last %></td>

		<td><%= time_ago_in_words(user.last_submitted_at) if user.last_submitted_at %></td>

		<td>
			<% if user.submits.last and user.submits.last.grade %>
			<%= grade_button_html(0, nil, user.submits.last.grade.any_final_grade, true) %>
			<% end %>
		</td>
	</tr>
	<% end %>

	<% end %>

</table>


<!-- Large modal -->

<div id="user-modal" class="modal bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div id="modal-header" class="modal-header">
        <h5 class="modal-title"></h5>
      </div>
      <div id="modal-body" class="modal-body">
        <p style="text-align:center; font-size:xx-large"><%= fa_icon 'cog', class:'fa-spin' %></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div></div>

<script>
	$('#user-modal').on('show.bs.modal', function (e) {
		$('#modal-header').html("");
		$('#modal-body').html('<p style="text-align:center; font-size:xx-large"><%= fa_icon "cog", class:"fa-spin" %></p>');
		
		elt = $(e.relatedTarget);
		$.ajax('/user/' + elt.data("user"));
	})
</script>
